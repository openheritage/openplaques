<% content_for :page_title, "Editing " + @person.name %>

<div class="panel">
  <h1>Edit details about <%= link_to @person.name, @person %></h1>

  <%= form_for @person do |f| %>
    <p><%= f.label :name %> <%= f.text_field :name %></p>
    <p><%= f.label :born_on, "Born" %> <%= text_field_tag :born_on, @born_on, {:maxlength => "4"} %> <%= f.label :died_on, "Died" %> <%= text_field_tag :died_on, @died_on, {:maxlength => "4"} %></p>

    <p><%= f.label :introduction %></p>
    <%= f.text_area :introduction, :cols => 80, :rows => 15 %>

    <p>The <%= f.label :wikipedia_url %> <%= f.text_field :wikipedia_url %> overrides the default generated one if it's incorrect. Set it to blank if there is no Wikipedia page.</p>
    <p><%= f.label :wikipedia_paras %> <%= f.text_field :wikipedia_paras %> e.g. "[1,4,5]", "1,2" or "2 4 7"<br/>
      <a href="<%= wikipedia_url(@person)%>"><%= wikipedia_url(@person)%></a><br/>
      "<%= wikipedia_summary_p(@person) %>"</p>
    <p><%= f.label :dbpedia_uri %> <%= f.text_field :dbpedia_uri %></p>
    <p>I believe the surname to be "<%= @person.surname %>"</p>
    <p><%= f.label :surname_starts_with %> <%= f.text_field :surname_starts_with, :maxlength => 1 %></p>
    <p><%= f.submit "Update", :class => :button %></p>
  <% end %>
</div>

<div class="panel">
  <p>This person features on plaques with inscriptions...
    <% @person.plaques.each do |plaque| %>
      <div class="plaque">
        <p>"<%= plaque.inscription %>"</p>
      </div>
    <% end %>

  <p>...from which we can establish that:</p>

  <% @person.personal_roles.each do |personal_role| %>
    <div>
      <%= @person.name %> was a <%= dated_role(personal_role) %> <%= link_to "Edit", edit_personal_role_path(personal_role) %>
      <%= button_to "Delete", personal_role, :method => :delete, :class => :button%>
    </div>
  <% end %>
  <p>
    <%= form_for @personal_role do |f| %>
      <%= f.hidden_field :person_id, :value => @person.id %>
      <%= @person.name %> was a <%= f.collection_select :role, @roles, :id, :name %> from <%= f.text_field :started_at %> to <%= f.text_field :ended_at %>
      <%= f.submit "Add", :class => :button %>
    <% end %>
  </p>

  <%= content_tag("p", link_to("Add new role", new_role_path)) if current_user %>
</div>
