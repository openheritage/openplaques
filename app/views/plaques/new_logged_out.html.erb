<script>
	$(function() {
		$( "#area" ).autocomplete({
			source: '/areas.json' ,
			select: function(event, ui){
						$('#country').val(ui.item.country_name);
						$('#area_id').val(ui.item.id);
						$('#plaque_country').val(ui.item.country_id);						
					},
			delay: 10
		});
	});
	
	$(function() {
		
		$( "#plaque_organisation_name" ).autocomplete({
			source: function(request, response) {
				$.ajax({
					url: "/organisations",
					dataType: "json",
					data: {
						name_starts_with: request.term
					},
					success: function(data) {
						response($.map(data, function(item) {
							return {
								label: item.organisation.name,
								id: item.organisation.id
							}
						}));
					}
				});
			},
			select: function(event, ui) {
				$('#plaque_organisation_id').val(ui.item.id);
			}
		});
	});
	</script>


<p>Thanks for spotting a plaque!</p>

<% if params[:checked] && params[:checked] == "true" %>

	<%= form_for(@plaque) do |f| %>

		<div><p><%= f.label :inscription, "Please type in the transcription on the plaque" %>:</p> <%= f.text_area :inscription %></div>
		
		<fieldset>
			<h2>Location</h2>
			<div>
			<label for="location">Street and number: </label>
				<%= text_field_tag :location, "", {:placeholder => "221B Baker Street"} %>
			</div>
				
			<div class="ui-widget">
				<label for="area">City/Town: </label>
				<%= text_field_tag :area, "", :placeholder => "London" %>
			</div>

			<div>
				<%= f.label :country %>
				<%= f.collection_select :country, @countries, :id, :name %>
			</div>
		
			<%= hidden_field_tag :area_id %>
		</fieldset>
			
		<fieldset>
			<h2>Who erected the plaque, and when?</h2>

			<%= f.fields_for :organisation do |g| %>
				<div>
					<%= g.label :name, "Organisation" %>
					<%= g.text_field :name, {:placeholder => "English Heritage"} %>
					<%= f.hidden_field :organisation_id %>
				</div>
								
			<% end %>

		</fieldset>			
			
		<h2>About you</h2>

		<%= f.fields_for :user do |g| %>
			<p>
				<%= g.label :name %>
				<%= g.text_field :name %>
			</p>

			<p>
				<%= g.label :email %>
				<%= g.text_field :email %>
			</p>
			
		<% end %>
		<%= f.submit "Save" %>

	<% end %>

<% else %>
	<p>First, let's just make sure it's not already in our database. Who or what is it about?</p>

	<%= form_tag("/search", :method => "get") do %>
	  <%= label_tag(:phrase, "Search: ") %>
	  <%= text_field_tag(:phrase) %>
		<%= hidden_field_tag(:from, :submission)%>
	  <%= submit_tag("Go", :name => nil) %>
	<% end %>
<% end %>